pipeline {
	agent any
	tools {
	  maven 'Maven 3.5'
	  git 'Default'
	  jdk 'Java 10'
	}
	stages {
	    stage("just Trying") {
	    	steps {
	        	echo 'Hello World'
	        }   
	    }
	    stage("Maven Build & JUnit Tests") {
	    	steps {
	    		sh 'mvn -f /home/ec2-user/workspace/DemoPipeline/javaApp/pom.xml clean package'
	    	}
	    }
	    stage("Delivery") {
	    	steps {
	    		echo 'Doing stuff on the server... probably'
			sshPublisher(publishers: [sshPublisherDesc(configName: 'Deployment Server', transfers: [sshTransfer(cleanRemote: false, excludes: '', execCommand: '', execTimeout: 120000, flatten: false, makeEmptyDirs: false, noDefaultExcludes: false, patternSeparator: '[, ]+', remoteDirectory: 'apache-tomcat-8.5.34/webapps', remoteDirectorySDF: false, removePrefix: '', sourceFiles: '/home/ec2-user/workspace/DemoPipeline/javaApp/target.war')], usePromotionTimestamp: false, useWorkspaceInPromotion: false, verbose: false)])
	    	}
	    }
	    stage("Selenium Test") {
	    	steps {
			sh 'xvfb-run mvn -f /home/ec2-user/workspace/DemoPipeline/javaApp/pom.xml failsafe:integration-test'
	    	}
	    }
	    stage("Emailing") {
	    	steps {
	    		echo 'You get an email, and you, and you...'
	    	}
	    }
    }
}
